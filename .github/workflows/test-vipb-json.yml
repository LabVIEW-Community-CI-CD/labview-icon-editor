name: Immediate VIPB ↔ JSON test (with folder tree and JSON print)

on: [workflow_dispatch]

jobs:
  roundtrip:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # Print working directory and tree
      - name: Print workspace and folder tree
        run: |
          echo "Working dir: $PWD"
          echo "GITHUB_WORKSPACE: $GITHUB_WORKSPACE"
          echo "Tree:"
          find . -type d | sort
          echo "Files:"
          find . -type f | sort

      - name: VIPB → JSON
        uses: svelderrainruiz/json-vipb@v0.1.4
        with:
          args: vipb2json "./Tooling/deployment/NI Icon editor LVAddon.vipb" roundtrip.json

      # ---------- PRINT JSON FILE CONTENTS ----------
      - name: Print JSON (pretty)
        run: |
          echo "-------------------"
          echo "iconeditor.json contents:"
          if command -v jq > /dev/null; then
            jq . iconeditor.json
          else
            cat iconeditor.json
          fi
          echo "-------------------"
          
      - uses: actions/upload-artifact@v4
        with:
          name: vipb-json-artifacts
          path: |
            iconeditor.json
            iconeditor.vipb
            roundtrip.json
